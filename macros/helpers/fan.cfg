[gcode_macro SET_FAN_SPEED]
gcode:
    {% set index = params.FAN|default(3)|int %}
    {% set speed = params.SPEED|default(0)|float * 255 | round | int %}
    M106 S{speed} P{index} 

[gcode_macro TURN_OFF_FAN]
description: Turn off one of the fans. If no fan index is given, the print cooling fan.
    TURN_OFF_FAN [FAN=<index>] 
gcode:
    SET_FAN_SPEED

[gcode_macro RESET_FAN]
gcode:
    {% set index = params.FAN|default(3)|int %}
    SET_FAN_SPEED FAN={index} SPEED=1. 
    G4 P1500
    TURN_OFF_FAN FAN={index}
